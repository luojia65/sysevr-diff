--- CVE-2015-3456_7.7_CWE-119_e907746266721f305d67bc0718795fedee2e824c_fdc.c_72_OLD.vul	2020-05-20 08:34:34.419385873 -0400
+++ CVE-2015-3456_7.7_CWE-119_e907746266721f305d67bc0718795fedee2e824c_fdc.c_72_NEW.vul	2020-05-20 08:34:34.419385873 -0400
@@ -1,7 +1,7 @@
 static void fdctrl_write_data(FDCtrl *fdctrl, uint32_t value)
 {
     FDrive *cur_drv;
-    int pos;
+    uint32_t pos;
 
     /* Reset mode */
     if (!(fdctrl->dor & FD_DOR_nRESET)) {
@@ -50,7 +50,9 @@
     }
 
     FLOPPY_DPRINTF("%s: %02x\n", __func__, value);
-    fdctrl->fifo[fdctrl->data_pos++] = value;
+    pos = fdctrl->data_pos++;
+    pos %= FD_SECTOR_LEN;
+    fdctrl->fifo[pos] = value;
     if (fdctrl->data_pos == fdctrl->data_len) {
         /* We now have all parameters
          * and will be able to treat the command
