--- CVE-2015-2756_4.9_CWE-264_81b23ef82cd1be29ca3d69ab7e98b5b5e55926ce_xen_pt_config_init.c_17_OLD.vul	2020-05-20 08:33:22.689590509 -0400
+++ CVE-2015-2756_4.9_CWE-264_81b23ef82cd1be29ca3d69ab7e98b5b5e55926ce_xen_pt_config_init.c_17_NEW.vul	2020-05-20 08:33:22.689590509 -0400
@@ -5,18 +5,13 @@
     XenPTRegInfo *reg = cfg_entry->reg;
     uint16_t writable_mask = 0;
     uint16_t throughable_mask = 0;
-    uint16_t emu_mask = reg->emu_mask;
-
-    if (s->is_virtfn) {
-        emu_mask |= PCI_COMMAND_MEMORY;
-    }
 
     /* modify emulate register */
     writable_mask = ~reg->ro_mask & valid_mask;
     cfg_entry->data = XEN_PT_MERGE_VALUE(*val, cfg_entry->data, writable_mask);
 
     /* create value for writing to I/O device register */
-    throughable_mask = ~emu_mask & valid_mask;
+    throughable_mask = ~reg->emu_mask & valid_mask;
 
     if (*val & PCI_COMMAND_INTX_DISABLE) {
         throughable_mask |= PCI_COMMAND_INTX_DISABLE;
