--- CVE-2018-16847_4.6_CWE-125_5e3c0220d7e4f0361c4d36c697a8842f2b583402_nvme.c_43_OLD.vul	2020-05-20 08:42:17.086390431 -0400
+++ CVE-2018-16847_4.6_CWE-125_5e3c0220d7e4f0361c4d36c697a8842f2b583402_nvme.c_43_NEW.vul	2020-05-20 08:42:17.086390431 -0400
@@ -3,6 +3,9 @@
     uint64_t val;
     NvmeCtrl *n = (NvmeCtrl *)opaque;
 
+    if (addr + size > NVME_CMBSZ_GETSIZE(n->bar.cmbsz)) {
+        return 0;
+    }
     memcpy(&val, &n->cmbuf[addr], size);
     return val;
 }
