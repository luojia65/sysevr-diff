--- CVE-2013-4537_7.5_CWE-094_95d9149ed3d0edfbb5223ceee03022498bc86155_ssi-sd.c_3_OLD.vul	2020-05-20 08:44:59.612342532 -0400
+++ CVE-2013-4537_7.5_CWE-094_95d9149ed3d0edfbb5223ceee03022498bc86155_ssi-sd.c_3_NEW.vul	2020-05-20 08:44:59.612342532 -0400
@@ -14,8 +14,17 @@
     for (i = 0; i < 5; i++)
         s->response[i] = qemu_get_be32(f);
     s->arglen = qemu_get_be32(f);
+    if (s->mode == SSI_SD_CMDARG &&
+        (s->arglen < 0 || s->arglen >= ARRAY_SIZE(s->cmdarg))) {
+        return -EINVAL;
+    }
     s->response_pos = qemu_get_be32(f);
     s->stopping = qemu_get_be32(f);
+    if (s->mode == SSI_SD_RESPONSE &&
+        (s->response_pos < 0 || s->response_pos >= ARRAY_SIZE(s->response) ||
+        (!s->stopping && s->arglen > ARRAY_SIZE(s->response)))) {
+        return -EINVAL;
+    }
 
     ss->cs = qemu_get_be32(f);
 
