--- CVE-2008-2004_4.9_CWE-200_79368c81bf8cf93864d7afc88b81b05d8f0a2c90_block.c_20_OLD.vul	2020-05-20 08:37:03.098053621 -0400
+++ CVE-2008-2004_4.9_CWE-200_79368c81bf8cf93864d7afc88b81b05d8f0a2c90_block.c_20_NEW.vul	2020-05-20 08:37:03.098053621 -0400
@@ -2,6 +2,7 @@
               BlockDriver *drv)
 {
     int ret;
+    int probed = 0;
 
     if (flags & BDRV_O_SNAPSHOT) {
         BlockDriverState *bs1;
@@ -62,6 +63,7 @@
     /* Find the right image format driver */
     if (!drv) {
         drv = find_image_format(filename);
+        probed = 1;
     }
 
     if (!drv) {
@@ -75,6 +77,8 @@
         goto unlink_and_fail;
     }
 
+    bs->probed = probed;
+
     /* If there is a backing file, use it */
     if ((flags & BDRV_O_NO_BACKING) == 0 && bs->backing_file[0] != '\0') {
         char backing_filename[PATH_MAX];
