--- CVE-2014-0148_0.0_CWE-000_1786c4225db1ff1241d76e1f96a2acc1bea51d2d_vhdx.c_15_OLD.vul	2020-05-20 08:32:00.603643426 -0400
+++ CVE-2014-0148_0.0_CWE-000_1786c4225db1ff1241d76e1f96a2acc1bea51d2d_vhdx.c_15_NEW.vul	2020-05-20 08:32:00.603643426 -0400
@@ -175,12 +175,20 @@
     le32_to_cpus(&s->logical_sector_size);
     le32_to_cpus(&s->physical_sector_size);
 
-    if (s->logical_sector_size == 0 || s->params.block_size == 0) {
+    if (s->params.block_size < VHDX_BLOCK_SIZE_MIN ||
+        s->params.block_size > VHDX_BLOCK_SIZE_MAX) {
         ret = -EINVAL;
         goto exit;
     }
 
-    /* both block_size and sector_size are guaranteed powers of 2 */
+    /* only 2 supported sector sizes */
+    if (s->logical_sector_size != 512 && s->logical_sector_size != 4096) {
+        ret = -EINVAL;
+        goto exit;
+    }
+
+    /* Both block_size and sector_size are guaranteed powers of 2, below.
+       Due to range checks above, s->sectors_per_block can never be < 256 */
     s->sectors_per_block = s->params.block_size / s->logical_sector_size;
     s->chunk_ratio = (VHDX_MAX_SECTORS_PER_BLOCK) *
                      (uint64_t)s->logical_sector_size /
