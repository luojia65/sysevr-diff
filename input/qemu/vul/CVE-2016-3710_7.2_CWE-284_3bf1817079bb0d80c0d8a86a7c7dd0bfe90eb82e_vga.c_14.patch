--- CVE-2016-3710_7.2_CWE-284_3bf1817079bb0d80c0d8a86a7c7dd0bfe90eb82e_vga.c_14_OLD.vul	2020-05-20 08:48:21.456831363 -0400
+++ CVE-2016-3710_7.2_CWE-284_3bf1817079bb0d80c0d8a86a7c7dd0bfe90eb82e_vga.c_14_NEW.vul	2020-05-20 08:48:21.456831363 -0400
@@ -29,13 +29,21 @@
 
     if (s->sr[VGA_SEQ_MEMORY_MODE] & VGA_SR04_CHN_4M) {
         /* chain 4 mode : simplest access */
+        assert(addr < s->vram_size);
         ret = s->vram_ptr[addr];
     } else if (s->gr[VGA_GFX_MODE] & 0x10) {
         /* odd/even mode (aka text mode mapping) */
         plane = (s->gr[VGA_GFX_PLANE_READ] & 2) | (addr & 1);
-        ret = s->vram_ptr[((addr & ~1) << 1) | plane];
+        addr = ((addr & ~1) << 1) | plane;
+        if (addr >= s->vram_size) {
+            return 0xff;
+        }
+        ret = s->vram_ptr[addr];
     } else {
         /* standard VGA latched access */
+        if (addr * sizeof(uint32_t) >= s->vram_size) {
+            return 0xff;
+        }
         s->latch = ((uint32_t *)s->vram_ptr)[addr];
 
         if (!(s->gr[VGA_GFX_MODE] & 0x08)) {
