--- CVE-2016-9603_9.0_CWE-119_63fdb09491325e22e6a9d68b0f4375a5126dd261_cirrus_vga.c_15_OLD.vul	2020-05-20 08:43:16.164192085 -0400
+++ CVE-2016-9603_9.0_CWE-119_63fdb09491325e22e6a9d68b0f4375a5126dd261_cirrus_vga.c_15_NEW.vul	2020-05-20 08:43:16.164192085 -0400
@@ -44,21 +44,15 @@
         }
     }
 
-    /* we have to flush all pending changes so that the copy
-       is generated at the appropriate moment in time */
-    if (notify)
-        graphic_hw_update(s->vga.con);
-
     (*s->cirrus_rop) (s, s->vga.vram_ptr + s->cirrus_blt_dstaddr,
                       s->vga.vram_ptr + s->cirrus_blt_srcaddr,
 		      s->cirrus_blt_dstpitch, s->cirrus_blt_srcpitch,
 		      s->cirrus_blt_width, s->cirrus_blt_height);
 
     if (notify) {
-        qemu_console_copy(s->vga.con,
-			  sx, sy, dx, dy,
-			  s->cirrus_blt_width / depth,
-			  s->cirrus_blt_height);
+        dpy_gfx_update(s->vga.con, dx, dy,
+                       s->cirrus_blt_width / depth,
+                       s->cirrus_blt_height);
     }
 
     /* we don't have to notify the display that this portion has
