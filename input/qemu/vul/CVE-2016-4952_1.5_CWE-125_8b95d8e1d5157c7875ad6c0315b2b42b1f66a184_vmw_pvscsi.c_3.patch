--- CVE-2016-4952_1.5_CWE-125_8b95d8e1d5157c7875ad6c0315b2b42b1f66a184_vmw_pvscsi.c_3_OLD.vul	2020-05-20 08:37:15.833583573 -0400
+++ CVE-2016-4952_1.5_CWE-125_8b95d8e1d5157c7875ad6c0315b2b42b1f66a184_vmw_pvscsi.c_3_NEW.vul	2020-05-20 08:37:15.833583573 -0400
@@ -1,10 +1,13 @@
-static void
+static int
 pvscsi_ring_init_msg(PVSCSIRingInfo *m, PVSCSICmdDescSetupMsgRing *ri)
 {
     int i;
     uint32_t len_log2;
     uint32_t ring_size;
 
+    if (ri->numPages > PVSCSI_SETUP_MSG_RING_MAX_NUM_PAGES) {
+        return -1;
+    }
     ring_size = ri->numPages * PVSCSI_MAX_NUM_MSG_ENTRIES_PER_PAGE;
     len_log2 = pvscsi_log2(ring_size - 1);
 
@@ -24,4 +27,6 @@
 
     /* Flush ring state page changes */
     smp_wmb();
+
+    return 0;
 }
