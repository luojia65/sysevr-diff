--- CVE-2014-0143_4.4_CWE-190_6a83f8b5bec6f59e56cc49bd49e4c3f8f805d56f_qcow2-snapshot.c_11_OLD.vul	2020-05-20 08:52:26.107727242 -0400
+++ CVE-2014-0143_4.4_CWE-190_6a83f8b5bec6f59e56cc49bd49e4c3f8f805d56f_qcow2-snapshot.c_11_NEW.vul	2020-05-20 08:52:26.107727242 -0400
@@ -22,6 +22,10 @@
     sn = &s->snapshots[snapshot_index];
 
     /* Allocate and read in the snapshot's L1 table */
+    if (sn->l1_size > QCOW_MAX_L1_SIZE) {
+        error_setg(errp, "Snapshot L1 table too large");
+        return -EFBIG;
+    }
     new_l1_bytes = sn->l1_size * sizeof(uint64_t);
     new_l1_table = g_malloc0(align_offset(new_l1_bytes, 512));
 
