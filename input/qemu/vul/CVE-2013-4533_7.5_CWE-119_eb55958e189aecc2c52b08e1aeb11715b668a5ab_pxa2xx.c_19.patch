--- CVE-2013-4533_7.5_CWE-119_eb55958e189aecc2c52b08e1aeb11715b668a5ab_pxa2xx.c_19_OLD.vul	2020-05-20 08:48:29.272540519 -0400
+++ CVE-2013-4533_7.5_CWE-119_eb55958e189aecc2c52b08e1aeb11715b668a5ab_pxa2xx.c_19_NEW.vul	2020-05-20 08:48:29.272540519 -0400
@@ -1,7 +1,7 @@
 static int pxa2xx_ssp_load(QEMUFile *f, void *opaque, int version_id)
 {
     PXA2xxSSPState *s = (PXA2xxSSPState *) opaque;
-    int i;
+    int i, v;
 
     s->enable = qemu_get_be32(f);
 
@@ -15,7 +15,11 @@
     qemu_get_8s(f, &s->ssrsa);
     qemu_get_8s(f, &s->ssacd);
 
-    s->rx_level = qemu_get_byte(f);
+    v = qemu_get_byte(f);
+    if (v < 0 || v > ARRAY_SIZE(s->rx_fifo)) {
+        return -EINVAL;
+    }
+    s->rx_level = v;
     s->rx_start = 0;
     for (i = 0; i < s->rx_level; i ++)
         s->rx_fifo[i] = qemu_get_byte(f);
