--- CVE-2016-5403_4.9_CWE-399_86cc089aa7251a6ce54e54458ed29a7867e69290_virtio.c_30_OLD.vul	2020-05-20 08:36:01.068326583 -0400
+++ CVE-2016-5403_4.9_CWE-399_86cc089aa7251a6ce54e54458ed29a7867e69290_virtio.c_30_NEW.vul	2020-05-20 08:36:01.068326583 -0400
@@ -21,6 +21,11 @@
 
     max = vq->vring.num;
 
+    if (vq->inuse >= vq->vring.num) {
+        error_report("Virtqueue size exceeded");
+        exit(1);
+    }
+
     i = head = virtqueue_get_head(vq, vq->last_avail_idx++);
     if (virtio_vdev_has_feature(vdev, VIRTIO_RING_F_EVENT_IDX)) {
         vring_set_avail_event(vq, vq->last_avail_idx);
