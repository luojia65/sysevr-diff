--- CVE-2007-1320_7.2_CWE-119_b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef_cirrus_vga.c_14_OLD.vul	2020-05-20 08:34:04.276372807 -0400
+++ CVE-2007-1320_7.2_CWE-119_b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef_cirrus_vga.c_14_NEW.vul	2020-05-20 08:34:04.276372807 -0400
@@ -5,8 +5,14 @@
 		       s->cirrus_blt_srcaddr - s->start_addr,
 		       s->cirrus_blt_width, s->cirrus_blt_height);
     } else {
-	(*s->cirrus_rop) (s, s->vram_ptr + s->cirrus_blt_dstaddr,
-			  s->vram_ptr + s->cirrus_blt_srcaddr,
+
+    if (BLTUNSAFE(s))
+        return 0;
+
+	(*s->cirrus_rop) (s, s->vram_ptr +
+                (s->cirrus_blt_dstaddr & s->cirrus_addr_mask),
+			  s->vram_ptr +
+                (s->cirrus_blt_srcaddr & s->cirrus_addr_mask),
 			  s->cirrus_blt_dstpitch, s->cirrus_blt_srcpitch,
 			  s->cirrus_blt_width, s->cirrus_blt_height);
 
