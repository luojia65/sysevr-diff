--- CVE-2015-3209_7.5_CWE-119_9f7c594c006289ad41169b854d70f5da6e400a2a_pcnet.c_21_OLD.vul	2020-05-20 08:34:22.527782701 -0400
+++ CVE-2015-3209_7.5_CWE-119_9f7c594c006289ad41169b854d70f5da6e400a2a_pcnet.c_21_NEW.vul	2020-05-20 08:34:22.527782701 -0400
@@ -44,6 +44,14 @@
         }
 
         bcnt = 4096 - GET_FIELD(tmd.length, TMDL, BCNT);
+
+        /* if multi-tmd packet outsizes s->buffer then skip it silently.
+           Note: this is not what real hw does */
+        if (s->xmit_pos + bcnt > sizeof(s->buffer)) {
+            s->xmit_pos = -1;
+            goto txdone;
+        }
+
         s->phys_mem_read(s->dma_opaque, PHYSADDR(s, tmd.tbadr),
                          s->buffer + s->xmit_pos, bcnt, CSR_BSWP(s));
         s->xmit_pos += bcnt;
