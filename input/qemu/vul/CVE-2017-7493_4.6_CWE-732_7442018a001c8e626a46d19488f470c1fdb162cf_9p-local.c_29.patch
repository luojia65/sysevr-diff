--- CVE-2017-7493_4.6_CWE-732_7442018a001c8e626a46d19488f470c1fdb162cf_9p-local.c_29_OLD.vul	2020-05-20 08:36:34.787095159 -0400
+++ CVE-2017-7493_4.6_CWE-732_7442018a001c8e626a46d19488f470c1fdb162cf_9p-local.c_29_NEW.vul	2020-05-20 08:36:34.787095159 -0400
@@ -6,6 +6,12 @@
     int ret = -1;
     int odirfd, ndirfd;
 
+    if (ctx->export_flags & V9FS_SM_MAPPED_FILE &&
+        local_is_mapped_file_metadata(ctx, name)) {
+        errno = EINVAL;
+        return -1;
+    }
+
     odirfd = local_opendir_nofollow(ctx, odirpath);
     if (odirfd == -1) {
         goto out;
