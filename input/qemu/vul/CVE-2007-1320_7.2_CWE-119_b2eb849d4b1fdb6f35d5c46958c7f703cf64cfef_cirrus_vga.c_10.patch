--- CVE-2007-1320_7.2_CWE-119_b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef_cirrus_vga.c_10_OLD.vul	2020-05-20 08:34:04.292372301 -0400
+++ CVE-2007-1320_7.2_CWE-119_b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef_cirrus_vga.c_10_NEW.vul	2020-05-20 08:34:04.296372175 -0400
@@ -3,7 +3,11 @@
 {
     uint8_t *dst;
 
-    dst = s->vram_ptr + s->cirrus_blt_dstaddr;
+    dst = s->vram_ptr + (s->cirrus_blt_dstaddr & s->cirrus_addr_mask);
+
+    if (BLTUNSAFE(s))
+        return 0;
+
     (*s->cirrus_rop) (s, dst, src,
                       s->cirrus_blt_dstpitch, 0,
                       s->cirrus_blt_width, s->cirrus_blt_height);
