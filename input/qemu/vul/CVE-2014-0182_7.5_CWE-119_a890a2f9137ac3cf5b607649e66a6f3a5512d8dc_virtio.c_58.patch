--- CVE-2014-0182_7.5_CWE-119_a890a2f9137ac3cf5b607649e66a6f3a5512d8dc_virtio.c_58_OLD.vul	2020-05-20 08:41:53.375272732 -0400
+++ CVE-2014-0182_7.5_CWE-119_a890a2f9137ac3cf5b607649e66a6f3a5512d8dc_virtio.c_58_NEW.vul	2020-05-20 08:41:53.375272732 -0400
@@ -1,6 +1,7 @@
 int virtio_load(VirtIODevice *vdev, QEMUFile *f)
 {
     int i, ret;
+    int32_t config_len;
     uint32_t num;
     uint32_t features;
     uint32_t supported_features;
@@ -27,7 +28,12 @@
                      features, supported_features);
         return -1;
     }
-    vdev->config_len = qemu_get_be32(f);
+    config_len = qemu_get_be32(f);
+    if (config_len != vdev->config_len) {
+        error_report("Unexpected config length 0x%x. Expected 0x%zx",
+                     config_len, vdev->config_len);
+        return -1;
+    }
     qemu_get_buffer(f, vdev->config, vdev->config_len);
 
     num = qemu_get_be32(f);
