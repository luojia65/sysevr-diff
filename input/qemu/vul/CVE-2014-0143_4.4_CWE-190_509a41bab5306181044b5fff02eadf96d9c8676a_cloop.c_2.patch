--- CVE-2014-0143_4.4_CWE-190_509a41bab5306181044b5fff02eadf96d9c8676a_cloop.c_2_OLD.vul	2020-05-20 08:46:29.636992468 -0400
+++ CVE-2014-0143_4.4_CWE-190_509a41bab5306181044b5fff02eadf96d9c8676a_cloop.c_2_NEW.vul	2020-05-20 08:46:29.636992468 -0400
@@ -41,6 +41,13 @@
     s->n_blocks = be32_to_cpu(s->n_blocks);
 
     /* read offsets */
+    if (s->n_blocks > UINT32_MAX / sizeof(uint64_t)) {
+        /* Prevent integer overflow */
+        error_setg(errp, "n_blocks %u must be %zu or less",
+                   s->n_blocks,
+                   UINT32_MAX / sizeof(uint64_t));
+        return -EINVAL;
+    }
     offsets_size = s->n_blocks * sizeof(uint64_t);
     s->offsets = g_malloc(offsets_size);
 
