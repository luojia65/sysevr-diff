--- CVE-2007-1320_7.2_CWE-119_b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef_cirrus_vga.c_11_OLD.vul	2020-05-20 08:34:04.304371922 -0400
+++ CVE-2007-1320_7.2_CWE-119_b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef_cirrus_vga.c_11_NEW.vul	2020-05-20 08:34:04.304371922 -0400
@@ -2,8 +2,10 @@
 {
     cirrus_fill_t rop_func;
 
+    if (BLTUNSAFE(s))
+        return 0;
     rop_func = cirrus_fill[rop_to_index[blt_rop]][s->cirrus_blt_pixelwidth - 1];
-    rop_func(s, s->vram_ptr + s->cirrus_blt_dstaddr,
+    rop_func(s, s->vram_ptr + (s->cirrus_blt_dstaddr & s->cirrus_addr_mask),
              s->cirrus_blt_dstpitch,
              s->cirrus_blt_width, s->cirrus_blt_height);
     cirrus_invalidate_region(s, s->cirrus_blt_dstaddr,
