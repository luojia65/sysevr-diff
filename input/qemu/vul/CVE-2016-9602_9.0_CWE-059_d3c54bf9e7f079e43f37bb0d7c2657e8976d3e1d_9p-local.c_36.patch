--- CVE-2016-9602_9.0_CWE-059_d3c54bf9e7f079e43f37bb0d7c2657e8976d3e1d_9p-local.c_36_OLD.vul	2020-05-20 08:49:28.630331650 -0400
+++ CVE-2016-9602_9.0_CWE-059_d3c54bf9e7f079e43f37bb0d7c2657e8976d3e1d_9p-local.c_36_NEW.vul	2020-05-20 08:49:28.630331650 -0400
@@ -1,11 +1,9 @@
 static int local_statfs(FsContext *s, V9fsPath *fs_path, struct statfs *stbuf)
 {
-    char *buffer;
-    int ret;
-    char *path = fs_path->data;
+    int fd, ret;
 
-    buffer = rpath(s, path);
-    ret = statfs(buffer, stbuf);
-    g_free(buffer);
+    fd = local_open_nofollow(s, fs_path->data, O_RDONLY, 0);
+    ret = fstatfs(fd, stbuf);
+    close_preserve_errno(fd);
     return ret;
 }
