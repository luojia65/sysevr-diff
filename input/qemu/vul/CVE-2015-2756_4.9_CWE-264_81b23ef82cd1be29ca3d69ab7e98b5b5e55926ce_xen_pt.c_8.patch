--- CVE-2015-2756_4.9_CWE-264_81b23ef82cd1be29ca3d69ab7e98b5b5e55926ce_xen_pt.c_8_OLD.vul	2020-05-20 08:33:19.441675345 -0400
+++ CVE-2015-2756_4.9_CWE-264_81b23ef82cd1be29ca3d69ab7e98b5b5e55926ce_xen_pt.c_8_NEW.vul	2020-05-20 08:33:19.441675345 -0400
@@ -1,4 +1,4 @@
-static int xen_pt_register_regions(XenPCIPassthroughState *s)
+static int xen_pt_register_regions(XenPCIPassthroughState *s, uint16_t *cmd)
 {
     int i = 0;
     XenHostPCIDevice *d = &s->real_device;
@@ -16,6 +16,7 @@
 
         if (r->type & XEN_HOST_PCI_REGION_TYPE_IO) {
             type = PCI_BASE_ADDRESS_SPACE_IO;
+            *cmd |= PCI_COMMAND_IO;
         } else {
             type = PCI_BASE_ADDRESS_SPACE_MEMORY;
             if (r->type & XEN_HOST_PCI_REGION_TYPE_PREFETCH) {
@@ -24,6 +25,7 @@
             if (r->type & XEN_HOST_PCI_REGION_TYPE_MEM_64) {
                 type |= PCI_BASE_ADDRESS_MEM_TYPE_64;
             }
+            *cmd |= PCI_COMMAND_MEMORY;
         }
 
         memory_region_init_io(&s->bar[i], OBJECT(s), &ops, &s->dev,
