--- CVE-2017-7493_4.6_CWE-732_7a95434e0ca8a037fd8aa1a2e2461f92585eb77b_9p-local.c_41_OLD.vul	2020-05-20 08:48:03.961482414 -0400
+++ CVE-2017-7493_4.6_CWE-732_7a95434e0ca8a037fd8aa1a2e2461f92585eb77b_9p-local.c_41_NEW.vul	2020-05-20 08:48:03.961482414 -0400
@@ -1,6 +1,12 @@
 static int local_name_to_path(FsContext *ctx, V9fsPath *dir_path,
                               const char *name, V9fsPath *target)
 {
+    if (ctx->export_flags & V9FS_SM_MAPPED_FILE &&
+        local_is_mapped_file_metadata(ctx, name)) {
+        errno = EINVAL;
+        return -1;
+    }
+
     if (dir_path) {
         v9fs_path_sprintf(target, "%s/%s", dir_path->data, name);
     } else if (strcmp(name, "/")) {
