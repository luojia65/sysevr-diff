--- CVE-2017-15119_5.0_CWE-400_2ce8993512fb5e6ba4d4f62cecd159d3862a9a7e_server.c_11_OLD.vul	2020-05-20 08:48:56.811515722 -0400
+++ CVE-2017-15119_5.0_CWE-400_2ce8993512fb5e6ba4d4f62cecd159d3862a9a7e_server.c_11_NEW.vul	2020-05-20 08:48:56.811515722 -0400
@@ -68,6 +68,12 @@
         }
         length = be32_to_cpu(length);
 
+        if (length > NBD_MAX_BUFFER_SIZE) {
+            error_setg(errp, "len (%" PRIu32" ) is larger than max len (%u)",
+                       length, NBD_MAX_BUFFER_SIZE);
+            return -EINVAL;
+        }
+
         trace_nbd_negotiate_options_check_option(option,
                                                  nbd_opt_lookup(option));
         if (client->tlscreds &&
