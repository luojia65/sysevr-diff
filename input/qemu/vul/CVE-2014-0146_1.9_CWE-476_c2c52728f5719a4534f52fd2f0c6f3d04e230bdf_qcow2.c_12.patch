--- CVE-2014-0146_1.9_CWE-476_c2c52728f5719a4534f52fd2f0c6f3d04e230bdf_qcow2.c_12_OLD.vul	2020-05-20 08:43:55.866714664 -0400
+++ CVE-2014-0146_1.9_CWE-476_c2c52728f5719a4534f52fd2f0c6f3d04e230bdf_qcow2.c_12_NEW.vul	2020-05-20 08:43:55.866714664 -0400
@@ -193,9 +193,6 @@
         goto fail;
     }
 
-    s->snapshots_offset = header.snapshots_offset;
-    s->nb_snapshots = header.nb_snapshots;
-
     /* read the level 1 table */
     if (header.l1_size > 0x2000000) {
         /* 32 MB L1 table is enough for 2 PB images at 64k cluster size
@@ -290,6 +287,10 @@
         bs->backing_file[len] = '\0';
     }
 
+    /* Internal snapshots */
+    s->snapshots_offset = header.snapshots_offset;
+    s->nb_snapshots = header.nb_snapshots;
+
     ret = qcow2_read_snapshots(bs);
     if (ret < 0) {
         error_setg_errno(errp, -ret, "Could not read snapshots");
