--- CVE-2013-6399_7.5_CWE-094_8f0e369a52ff0b5e0642bda47e2ead3c7e273fe1_virtio.c_58_OLD.vul	2020-05-20 08:51:32.797711047 -0400
+++ CVE-2013-6399_7.5_CWE-094_8f0e369a52ff0b5e0642bda47e2ead3c7e273fe1_virtio.c_58_NEW.vul	2020-05-20 08:51:32.797711047 -0400
@@ -16,6 +16,9 @@
     qemu_get_8s(f, &vdev->status);
     qemu_get_8s(f, &vdev->isr);
     qemu_get_be16s(f, &vdev->queue_sel);
+    if (vdev->queue_sel >= VIRTIO_PCI_QUEUE_MAX) {
+        return -1;
+    }
     qemu_get_be32s(f, &features);
 
     if (virtio_set_features(vdev, features) < 0) {
