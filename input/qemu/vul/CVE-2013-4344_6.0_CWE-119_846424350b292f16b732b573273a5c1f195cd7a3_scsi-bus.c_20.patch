--- CVE-2013-4344_6.0_CWE-119_846424350b292f16b732b573273a5c1f195cd7a3_scsi-bus.c_20_OLD.vul	2020-05-20 08:42:04.842846024 -0400
+++ CVE-2013-4344_6.0_CWE-119_846424350b292f16b732b573273a5c1f195cd7a3_scsi-bus.c_20_NEW.vul	2020-05-20 08:42:04.842846024 -0400
@@ -14,8 +14,9 @@
         }
         break;
     case REQUEST_SENSE:
+        scsi_target_alloc_buf(&r->req, SCSI_SENSE_LEN);
         r->len = scsi_device_get_sense(r->req.dev, r->buf,
-                                       MIN(req->cmd.xfer, sizeof r->buf),
+                                       MIN(req->cmd.xfer, r->buf_len),
                                        (req->cmd.buf[1] & 1) == 0);
         if (r->req.dev->sense_is_ua) {
             scsi_device_unit_attention_reported(req->dev);
