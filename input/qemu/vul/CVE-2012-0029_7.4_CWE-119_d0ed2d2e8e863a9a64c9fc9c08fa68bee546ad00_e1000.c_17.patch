--- CVE-2012-0029_7.4_CWE-119_d0ed2d2e8e863a9a64c9fc9c08fa68bee546ad00_e1000.c_17_OLD.vul	2020-05-20 08:37:32.992949160 -0400
+++ CVE-2012-0029_7.4_CWE-119_d0ed2d2e8e863a9a64c9fc9c08fa68bee546ad00_e1000.c_17_NEW.vul	2020-05-20 08:37:32.992949160 -0400
@@ -57,6 +57,8 @@
             bytes = split_size;
             if (tp->size + bytes > msh)
                 bytes = msh - tp->size;
+
+            bytes = MIN(sizeof(tp->data) - tp->size, bytes);
             pci_dma_read(&s->dev, addr, tp->data + tp->size, bytes);
             if ((sz = tp->size + bytes) >= hdr && tp->size < hdr)
                 memmove(tp->header, tp->data, hdr);
@@ -72,6 +74,7 @@
         // context descriptor TSE is not set, while data descriptor TSE is set
         DBGOUT(TXERR, "TCP segmentaion Error\n");
     } else {
+        split_size = MIN(sizeof(tp->data) - tp->size, split_size);
         pci_dma_read(&s->dev, addr, tp->data + tp->size, split_size);
         tp->size += split_size;
     }
