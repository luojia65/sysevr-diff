--- CVE-2017-15124_7.8_CWE-020_ada8d2e4369ea49677d8672ac81bce73eefd5b54_vnc-auth-sasl.c_2_OLD.vul	2020-05-20 08:36:49.082569907 -0400
+++ CVE-2017-15124_7.8_CWE-020_ada8d2e4369ea49677d8672ac81bce73eefd5b54_vnc-auth-sasl.c_2_NEW.vul	2020-05-20 08:36:49.082569907 -0400
@@ -29,6 +29,11 @@
 
     vs->sasl.encodedOffset += ret;
     if (vs->sasl.encodedOffset == vs->sasl.encodedLength) {
+        if (vs->sasl.encodedRawLength >= vs->force_update_offset) {
+            vs->force_update_offset = 0;
+        } else {
+            vs->force_update_offset -= vs->sasl.encodedRawLength;
+        }
         vs->output.offset -= vs->sasl.encodedRawLength;
         vs->sasl.encoded = NULL;
         vs->sasl.encodedOffset = vs->sasl.encodedLength = 0;
