--- CVE-2016-4454_3.2_CWE-119_71798fda8b6ef8df47c7640ba0bc24d7060ad307_vmware_vga.c_9_OLD.vul	2020-05-20 08:51:04.694756822 -0400
+++ CVE-2016-4454_3.2_CWE-119_71798fda8b6ef8df47c7640ba0bc24d7060ad307_vmware_vga.c_9_NEW.vul	2020-05-20 08:51:04.694756822 -0400
@@ -1,10 +1,11 @@
 static inline uint32_t vmsvga_fifo_read_raw(struct vmsvga_state_s *s)
 {
-    uint32_t cmd = s->fifo[CMD(stop) >> 2];
+    uint32_t cmd = s->fifo[s->fifo_stop >> 2];
 
-    s->cmd->stop = cpu_to_le32(CMD(stop) + 4);
-    if (CMD(stop) >= CMD(max)) {
-        s->cmd->stop = s->cmd->min;
+    s->fifo_stop += 4;
+    if (s->fifo_stop >= s->fifo_max) {
+        s->fifo_stop = s->fifo_min;
     }
+    s->fifo[SVGA_FIFO_STOP] = cpu_to_le32(s->fifo_stop);
     return cmd;
 }
