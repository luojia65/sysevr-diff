--- CVE-2013-4344_6.0_CWE-119_192d2f4cc7931668d4e4f10e882af3c097193c47_scsi-bus.c_20_OLD.vul	2020-05-20 08:39:59.603505384 -0400
+++ CVE-2013-4344_6.0_CWE-119_192d2f4cc7931668d4e4f10e882af3c097193c47_scsi-bus.c_20_NEW.vul	2020-05-20 08:39:59.603505384 -0400
@@ -15,7 +15,8 @@
         break;
     case REQUEST_SENSE:
         scsi_target_alloc_buf(&r->req, SCSI_SENSE_LEN);
-        r->len = scsi_device_get_sense(r->req.dev, r->buf, r->buf_len,
+        r->len = scsi_device_get_sense(r->req.dev, r->buf,
+                                       MIN(req->cmd.xfer, r->buf_len),
                                        (req->cmd.buf[1] & 1) == 0);
         if (r->req.dev->sense_is_ua) {
             scsi_device_unit_attention_reported(req->dev);
