--- CVE-2017-15124_7.8_CWE-020_ada8d2e4369ea49677d8672ac81bce73eefd5b54_vnc.c_49_OLD.vul	2020-05-20 08:36:54.870356846 -0400
+++ CVE-2017-15124_7.8_CWE-020_ada8d2e4369ea49677d8672ac81bce73eefd5b54_vnc.c_49_NEW.vul	2020-05-20 08:36:54.870356846 -0400
@@ -19,6 +19,11 @@
     if (!ret)
         return 0;
 
+    if (ret >= vs->force_update_offset) {
+        vs->force_update_offset = 0;
+    } else {
+        vs->force_update_offset -= ret;
+    }
     buffer_advance(&vs->output, ret);
 
     if (vs->output.offset == 0) {
