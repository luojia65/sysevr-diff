--- CVE-2014-0145_4.6_CWE-119_c165f7758009a4f793c1fc19ebb69cf55313450b_dmg.c_4_OLD.vul	2020-05-20 08:37:38.276753598 -0400
+++ CVE-2014-0145_4.6_CWE-119_c165f7758009a4f793c1fc19ebb69cf55313450b_dmg.c_4_NEW.vul	2020-05-20 08:37:38.280753450 -0400
@@ -114,6 +114,14 @@
                 }
                 offset += 8;
 
+                if (s->sectorcounts[i] > DMG_SECTORCOUNTS_MAX) {
+                    error_report("sector count %" PRIu64 " for chunk %u is "
+                                 "larger than max (%u)",
+                                 s->sectorcounts[i], i, DMG_SECTORCOUNTS_MAX);
+                    ret = -EINVAL;
+                    goto fail;
+                }
+
                 ret = read_uint64(bs, offset, &s->offsets[i]);
                 if (ret < 0) {
                     goto fail;
@@ -127,6 +135,14 @@
                 }
                 offset += 8;
 
+                if (s->lengths[i] > DMG_LENGTHS_MAX) {
+                    error_report("length %" PRIu64 " for chunk %u is larger "
+                                 "than max (%u)",
+                                 s->lengths[i], i, DMG_LENGTHS_MAX);
+                    ret = -EINVAL;
+                    goto fail;
+                }
+
                 if (s->lengths[i] > max_compressed_size) {
                     max_compressed_size = s->lengths[i];
                 }
