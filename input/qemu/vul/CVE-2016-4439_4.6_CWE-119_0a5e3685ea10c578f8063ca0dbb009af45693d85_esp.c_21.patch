--- CVE-2016-4439_4.6_CWE-119_0a5e3685ea10c578f8063ca0dbb009af45693d85_esp.c_21_OLD.vul	2020-05-20 08:42:34.085757876 -0400
+++ CVE-2016-4439_4.6_CWE-119_0a5e3685ea10c578f8063ca0dbb009af45693d85_esp.c_21_NEW.vul	2020-05-20 08:42:34.085757876 -0400
@@ -11,7 +11,11 @@
         break;
     case ESP_FIFO:
         if (s->do_cmd) {
-            s->cmdbuf[s->cmdlen++] = val & 0xff;
+            if (s->cmdlen < TI_BUFSZ) {
+                s->cmdbuf[s->cmdlen++] = val & 0xff;
+            } else {
+                trace_esp_error_fifo_overrun();
+            }
         } else if (s->ti_size == TI_BUFSZ - 1) {
             trace_esp_error_fifo_overrun();
         } else {
