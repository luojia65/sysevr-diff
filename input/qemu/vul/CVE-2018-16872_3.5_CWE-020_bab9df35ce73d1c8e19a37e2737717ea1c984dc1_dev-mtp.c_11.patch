--- CVE-2018-16872_3.5_CWE-020_bab9df35ce73d1c8e19a37e2737717ea1c984dc1_dev-mtp.c_11_OLD.vul	2020-05-20 08:35:21.457751527 -0400
+++ CVE-2018-16872_3.5_CWE-020_bab9df35ce73d1c8e19a37e2737717ea1c984dc1_dev-mtp.c_11_NEW.vul	2020-05-20 08:35:21.457751527 -0400
@@ -2,13 +2,18 @@
 {
     struct dirent *entry;
     DIR *dir;
+    int fd;
 
     if (o->have_children) {
         return;
     }
     o->have_children = true;
 
-    dir = opendir(o->path);
+    fd = open(o->path, O_DIRECTORY | O_CLOEXEC | O_NOFOLLOW);
+    if (fd < 0) {
+        return;
+    }
+    dir = fdopendir(fd);
     if (!dir) {
         return;
     }
