--- CVE-2013-2007_6.9_CWE-264_c689b4f1bac352dcfd6ecb9a1d45337de0f1de67_commands-posix.c_7_OLD.vul	2020-05-20 08:39:24.948794016 -0400
+++ CVE-2013-2007_6.9_CWE-264_c689b4f1bac352dcfd6ecb9a1d45337de0f1de67_commands-posix.c_7_NEW.vul	2020-05-20 08:39:24.948794016 -0400
@@ -1,6 +1,7 @@
 int64_t qmp_guest_file_open(const char *path, bool has_mode, const char *mode, Error **err)
 {
     FILE *fh;
+    Error *local_err = NULL;
     int fd;
     int64_t ret = -1, handle;
 
@@ -8,10 +9,9 @@
         mode = "r";
     }
     slog("guest-file-open called, filepath: %s, mode: %s", path, mode);
-    fh = fopen(path, mode);
-    if (!fh) {
-        error_setg_errno(err, errno, "failed to open file '%s' (mode: '%s')",
-                         path, mode);
+    fh = safe_open_or_create(path, mode, &local_err);
+    if (local_err != NULL) {
+        error_propagate(err, local_err);
         return -1;
     }
 
