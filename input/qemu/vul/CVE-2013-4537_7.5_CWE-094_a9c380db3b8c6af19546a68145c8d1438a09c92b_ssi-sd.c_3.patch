--- CVE-2013-4537_7.5_CWE-094_a9c380db3b8c6af19546a68145c8d1438a09c92b_ssi-sd.c_3_OLD.vul	2020-05-20 08:48:01.269582586 -0400
+++ CVE-2013-4537_7.5_CWE-094_a9c380db3b8c6af19546a68145c8d1438a09c92b_ssi-sd.c_3_NEW.vul	2020-05-20 08:48:01.269582586 -0400
@@ -14,8 +14,17 @@
     for (i = 0; i < 5; i++)
         s->response[i] = qemu_get_be32(f);
     s->arglen = qemu_get_be32(f);
+    if (s->mode == SSI_SD_CMDARG &&
+        (s->arglen < 0 || s->arglen >= ARRAY_SIZE(s->cmdarg))) {
+        return -EINVAL;
+    }
     s->response_pos = qemu_get_be32(f);
     s->stopping = qemu_get_be32(f);
+    if (s->mode == SSI_SD_RESPONSE &&
+        (s->response_pos < 0 || s->response_pos >= ARRAY_SIZE(s->response) ||
+        (!s->stopping && s->arglen > ARRAY_SIZE(s->response)))) {
+        return -EINVAL;
+    }
 
     ss->cs = qemu_get_be32(f);
 
