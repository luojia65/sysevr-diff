--- CVE-2018-16847_4.6_CWE-125_5e3c0220d7e4f0361c4d36c697a8842f2b583402_nvme.c_42_OLD.vul	2020-05-20 08:42:17.078390729 -0400
+++ CVE-2018-16847_4.6_CWE-125_5e3c0220d7e4f0361c4d36c697a8842f2b583402_nvme.c_42_NEW.vul	2020-05-20 08:42:17.078390729 -0400
@@ -2,5 +2,9 @@
     unsigned size)
 {
     NvmeCtrl *n = (NvmeCtrl *)opaque;
+
+    if (addr + size > NVME_CMBSZ_GETSIZE(n->bar.cmbsz)) {
+        return;
+    }
     memcpy(&n->cmbuf[addr], &data, size);
 }
