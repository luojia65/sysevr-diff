--- CVE-2011-4127_4.6_CWE-264_1ba1f2e319afdcb485963cd3f426fdffd1b725f2_virtio-blk.c_8_OLD.vul	2020-05-20 08:39:56.775610557 -0400
+++ CVE-2011-4127_4.6_CWE-264_1ba1f2e319afdcb485963cd3f426fdffd1b725f2_virtio-blk.c_8_NEW.vul	2020-05-20 08:39:56.775610557 -0400
@@ -5,6 +5,12 @@
     int status;
     int i;
 
+    if ((req->dev->vdev.guest_features & (1 << VIRTIO_BLK_F_SCSI)) == 0) {
+        virtio_blk_req_complete(req, VIRTIO_BLK_S_UNSUPP);
+        g_free(req);
+        return;
+    }
+
     /*
      * We require at least one output segment each for the virtio_blk_outhdr
      * and the SCSI command block.
