--- CVE-2014-0144_0.0_CWE-000_63fa06dc978f3669dbfd9443b33cde9e2a7f4b41_vdi.c_17_OLD.vul	2020-05-20 08:43:35.479473324 -0400
+++ CVE-2014-0144_0.0_CWE-000_63fa06dc978f3669dbfd9443b33cde9e2a7f4b41_vdi.c_17_NEW.vul	2020-05-20 08:43:35.479473324 -0400
@@ -34,11 +34,20 @@
         options++;
     }
 
+    if (bytes > VDI_DISK_SIZE_MAX) {
+        result = -ENOTSUP;
+        error_setg(errp, "Unsupported VDI image size (size is 0x%" PRIx64
+                          ", max supported is 0x%" PRIx64 ")",
+                          bytes, VDI_DISK_SIZE_MAX);
+        goto exit;
+    }
+
     fd = qemu_open(filename,
                    O_WRONLY | O_CREAT | O_TRUNC | O_BINARY | O_LARGEFILE,
                    0644);
     if (fd < 0) {
-        return -errno;
+        result = -errno;
+        goto exit;
     }
 
     /* We need enough blocks to store the given disk size,
@@ -99,5 +108,6 @@
         result = -errno;
     }
 
+exit:
     return result;
 }
